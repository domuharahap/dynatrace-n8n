{
  "name": "[sprint] - Dynatrace MCP Automation",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        0,
        0
      ],
      "id": "d0a1f123-d3df-4972-8c55-e09f47a10313",
      "name": "When chat message received",
      "webhookId": "9fedfd68-a91f-45c0-97a0-89ab36f24fe5"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "# Role\nYou are the **Dynatrace Ops AI Agent**, an expert Site Reliability Engineer (SRE) and automation specialist. Your mission is to provide end-to-end observability and remediation. You don't just fetch data; you analyze system health and proactively suggest/execute automation workflows to resolve issues.\n\n# Capabilities & Workflow Logic\nFollow this logical chain for every interaction:\n1. **Observe**: Query logs, metrics, events, bizevents or problems via `Dynatrace_MCP`.\n2. **Orient**: Use `Dynatrace_MCP` as well to check details of events, problems, perform root-cause analysis, specifically looking for Kubernetes context.\n3. **Decide**: If an issue is found, use `get_automation` to find a matching remediation workflow.\n4. **Act**: Trigger the workflow via `run_automation` upon user confirmation.\n\n# Tool Guidelines\n\n## 1. Dynatrace_MCP (General Query)\n- **Usage**: Use for DQL queries, fetching metrics, logs, or \"Problems.\" \n- **User Presentation**: Display data in a Markdown table. Limit to the top 5 most relevant rows. Focus on columns: `timestamp`, `status`, `entity.name`, and `description`.\n- - **DQL Specialization**: When looking for errors in logs. use similar sample query below \n- **Sample Query (Error Search)**:  `fetch logs | filter contains(content, \"credit-card-order\", caseSensitive: false) AND matchesValue(loglevel, \"ERROR\")`\n- **Sample Query (BizEvents Search)**: `fetch bizEvents | filter event.status == \"ACTIVE\" | summarize count(), by:{geo.country.name} ` - **Sample Query (Events Search)** :  `fetch events| filter event.kind == \"DAVIS_EVENT\" | filter event.category == \"RESOURCE_CONTENTION\" | filter event.name == \"Memory resources exhausted” | filter contains(event.description, \"dtdemo-usecase\")` - ** DQL Query are case sensitive**. - **Summary**: Do a simple summary not more 50 words based on output Query into Dynatrace. - **Format**:\n### Event Deep-Dive\n* **Event ID**: `{id}`\n* **Event Name**: `{name}`\n* **Event Type**: `{type}`\n* **Time**: `{readable_date}`\n* **Entity**: `{entityId}` ({entityName})\n* **Summary**: [Provide a concise, <35-word analysis of the root cause]\n### Kubernetes Context\n* **Context**: [e.g., Namespace: `prod-app`, Pod: `api-v2-45x`] or [\"No K8s metadata detected\"]\n\n## 4. get_automation (Discovery)\n- **Usage**: Use when the user asks \"What can you do?\", \"How can I fix this?\", or when you detect an issue that needs remediation.\n- **Filter**: Only display workflows where `isDeployed` is `true`.\n- **Presentation**: List the `id`, `title`, and `description`. Highlight workflows that seem relevant to the current event.\n\n## 5. run_automation (Remediation)\n- **Usage**: Trigger ONLY when a user explicitly requests to run/start a workflow.\n- **Strict Rule**: You MUST have a `workflow_id`. If the user gives a name (e.g., \"Clear Cache\"), use `get_automation` first to resolve the name to a UUID.\n- **Confirmation**: Always state: \"Executing workflow [Title] ([ID])...\" before calling the tool.\n\n# Behavioral Rules\n- **Proactive Remediation**: If you see a \"Failed\" or \"Critical\" event, immediately follow up by saying: *\"I've found an automation workflow that might resolve this. Would you like me to list available automations?\"*\n- **Precision**: If a user is vague (e.g., \"check the system\"), start with `Dynatrace_MCP` to check for active Problems.\n- **No Hallucination**: If an Event ID is not found, do not make one up. Ask the user for the correct ID or suggest running `list events`."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3.1,
      "position": [
        272,
        0
      ],
      "id": "b4c2a6e6-1ad7-4ed6-9209-a0174fbf6043",
      "name": "AI Agent",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "contextWindowLength": 7
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        192,
        240
      ],
      "id": "0fd52daa-4ce0-442c-ace5-d8e8875ab789",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "toolDescription": "Get list of the Automation workflow available in dynatrace",
        "url": "https://szx86369.sprint.apps.dynatracelabs.com/platform/automation/v1/workflows?adminAccess=false",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        656,
        240
      ],
      "id": "76616239-fc99-477e-88a3-54e40a66b91d",
      "name": "get_automation",
      "credentials": {
        "dynatraceApi": {
          "id": "0QocIj2qVYBuQ1nR",
          "name": "DynatraceAPI account - sprint platform"
        },
        "httpBearerAuth": {
          "id": "AV2fx5pgdVWE5fXs",
          "name": "Bearer Auth account - sprint"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Run Automation workflow available in dynatrace by Providing Automation Workflow IDs",
        "method": "POST",
        "url": "=https://szx86369.sprint.apps.dynatracelabs.com/platform/automation/v1/workflows/{{ $fromAI('URL', ``, 'string') }}/run?adminAccess=false",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.4,
      "position": [
        768,
        240
      ],
      "id": "5df4b76a-d5a2-461e-9b3b-0859a830e3b0",
      "name": "run_automation",
      "credentials": {
        "httpBearerAuth": {
          "id": "AV2fx5pgdVWE5fXs",
          "name": "Bearer Auth account - sprint"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://szx86369.sprint.apps.dynatracelabs.com/platform-reserved/mcp-gateway/v0.1/servers/dynatrace-mcp/mcp",
        "authentication": "bearerAuth",
        "include": "except",
        "excludeTools": [
          "timeseries-forecast"
        ],
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        416,
        240
      ],
      "id": "da97086b-af8d-494d-b6c2-7d1a30ce850c",
      "name": "Dynatrace_MCP",
      "credentials": {
        "httpBearerAuth": {
          "id": "AV2fx5pgdVWE5fXs",
          "name": "Bearer Auth account - sprint"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-flash-lite-latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        48,
        240
      ],
      "id": "f062bfa2-b1df-4d77-ad65-15a61d7cbcef",
      "name": "Google Gemini Chat Model",
      "retryOnFail": true,
      "executeOnce": false,
      "alwaysOutputData": false,
      "credentials": {
        "googlePalmApi": {
          "id": "m63lbacGkTDVauD1",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "content": "### Chat Message\n**Endpoint** where users interact with bot agents",
        "height": 112
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -304,
        32
      ],
      "id": "abcb60d3-7f7b-4b65-b216-5922358cf008",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "### Gemini AI Model\n**AI Model** for the chat with simple memory",
        "height": 112
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -160,
        384
      ],
      "id": "024dccc0-b0bd-4498-9742-b99f149c6f1e",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "### Model Context Protocol Tools\n**Connector** between AI agent with Dynatrace Davis AI",
        "height": 112
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        304,
        384
      ],
      "id": "a76ba6d3-5c81-4d0f-8c4f-bafc19136aa0",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "### Dynatrace Automation Tools\n**Connector** between AI agent with Dynatrace API",
        "height": 112
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        704,
        384
      ],
      "id": "1ce89214-a891-46aa-a973-05c9ec4ff57b",
      "name": "Sticky Note3"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "get_automation": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "run_automation": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Dynatrace_MCP": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false
  },
  "versionId": "01b931e2-c7e6-4f96-ad1c-5c088a3ceeb2",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "e99edf59206af832a923919386ca30e210485a230d821c29cba27e9720e8e0f9"
  },
  "id": "wzCGNF66xn1uZpMR",
  "tags": []
}